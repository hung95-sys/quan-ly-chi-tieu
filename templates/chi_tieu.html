<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chi ti√™u - Trang Web C√° Nh√¢n</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='chi_tieu.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='admin.css') }}">
    <script src="{{ url_for('static', filename='theme.js') }}" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>

<body class="chi-tieu-page">
    <!-- Header v·ªõi tabs -->
    <div class="chi-header">
        <div class="chi-tabs">
            <button class="chi-tab active" id="tab-chi-tieu">Chi ti√™u</button>
            <button class="chi-tab" id="tab-thu-nhap">Thu nh·∫≠p</button>
            <button class="chi-tab" id="tab-thu-quy">Thu qu·ªπ</button>
            <button class="chi-tab" id="tab-chi-quy">Chi qu·ªπ</button>
        </div>
        <div class="chi-user">
            <a href="{{ url_for('main.dashboard') }}" class="chi-home-link" title="V·ªÅ trang ch·ªß">üè†</a>
            <div class="user-profile-dropdown">
                <button class="user-profile-btn" onclick="toggleUserDropdown()"
                    style="padding: 6px 12px; border-radius: 12px; background: #f3f4f6; border: none;">
                    <div class="user-avatar" style="width: 32px; height: 32px; font-size: 0.9em;">{{
                        current_user.name[0].upper() if current_user.name else 'U' }}</div>
                    <span class="user-name-text" style="font-size: 0.95em;">{{ current_user.name }}</span>
                    <span class="dropdown-arrow">‚ñº</span>
                </button>
                <div class="user-dropdown-menu" id="userDropdown">
                    <a href="#" onclick="showChangePasswordModal(); return false;" class="dropdown-item">
                        <span class="dropdown-icon">üîë</span>
                        <span>ƒê·ªïi m·∫≠t kh·∫©u</span>
                    </a>
                    <a href="{{ url_for('auth.logout') }}" class="dropdown-item">
                        <span class="dropdown-icon">üö™</span>
                        <span>ƒêƒÉng xu·∫•t</span>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Container -->
    <div class="chi-container">
        <!-- Form nh·∫≠p li·ªáu -->
        <div id="form-section">
            <form id="expense-form">
                <!-- Ng√†y -->
                <div class="chi-field">
                    <label>Ng√†y</label>
                    <div class="chi-month-row">
                        <button type="button" class="btn" id="prev-day">‚Üê</button>
                        <input type="text" id="ngay" class="chi-input" readonly>
                        <button type="button" class="btn" id="next-day">‚Üí</button>
                    </div>
                </div>

                <!-- Ghi ch√∫ -->
                <div class="chi-field">
                    <label>Ghi ch√∫</label>
                    <input type="text" id="ghi-chu" class="chi-input" placeholder="Th√™m ghi ch√∫">
                </div>

                <!-- Ti·ªÅn chi/thu -->
                <div class="chi-field">
                    <label id="tien-label">Ti·ªÅn chi</label>
                    <div class="chi-input with-icon">
                        <input type="text" id="so-tien" inputmode="numeric" placeholder="0">
                        <span class="chi-icon">‚Ç´</span>
                    </div>
                </div>

                <!-- Danh m·ª•c -->
                <div class="chi-field" id="danh-muc-field">
                    <label>Danh m·ª•c</label>
                    <div class="chi-grid" id="categories-grid">
                        <button type="button" class="chi-cat active" data-category="ƒÇn u·ªëng">
                            <span class="icon">üçΩÔ∏è</span>
                            <span>ƒÇn u·ªëng</span>
                        </button>
                        <button type="button" class="chi-cat" data-category="Chi ti√™u h√†ng ng√†y">
                            <span class="icon">üß¥</span>
                            <span>Chi ti√™u h√†ng ng√†y</span>
                        </button>
                        <button type="button" class="chi-cat" data-category="Qu·∫ßn √°o">
                            <span class="icon">üëï</span>
                            <span>Qu·∫ßn √°o</span>
                        </button>
                        <button type="button" class="chi-cat" data-category="M·ªπ ph·∫©m">
                            <span class="icon">üíÑ</span>
                            <span>M·ªπ ph·∫©m</span>
                        </button>
                        <button type="button" class="chi-cat" data-category="Ph√≠ giao l∆∞u">
                            <span class="icon">ü•Ç</span>
                            <span>Ph√≠ giao l∆∞u</span>
                        </button>
                        <button type="button" class="chi-cat" data-category="Y t·∫ø">
                            <span class="icon">üíä</span>
                            <span>Y t·∫ø</span>
                        </button>
                        <button type="button" class="chi-cat" data-category="Gi√°o d·ª•c">
                            <span class="icon">‚úèÔ∏è</span>
                            <span>Gi√°o d·ª•c</span>
                        </button>
                        <button type="button" class="chi-cat" data-category="Ti·ªÅn ƒëi·ªán">
                            <span class="icon">üíß</span>
                            <span>Ti·ªÅn ƒëi·ªán</span>
                        </button>
                        <button type="button" class="chi-cat" data-category="ƒêi l·∫°i">
                            <span class="icon">üöÇ</span>
                            <span>ƒêi l·∫°i</span>
                        </button>
                        <button type="button" class="chi-cat" data-category="Ph√≠ li√™n l·∫°c">
                            <span class="icon">üìû</span>
                            <span>Ph√≠ li√™n l·∫°c</span>
                        </button>
                        <button type="button" class="chi-cat" data-category="Ti·ªÅn nh√†">
                            <span class="icon">üè†</span>
                            <span>Ti·ªÅn nh√†</span>
                        </button>
                        <button type="button" class="chi-cat" data-category="Ch·ªânh s·ª≠a">
                            <span class="icon">‚öôÔ∏è</span>
                            <span>Ch·ªânh s·ª≠a</span>
                        </button>
                    </div>
                </div>

                <!-- M·ª•c ƒë√≠ch qu·ªπ (·∫©n m·∫∑c ƒë·ªãnh) -->
                <div class="chi-field" id="muc-dich-quy-field" style="display: none;">
                    <label>M·ª•c ƒë√≠ch qu·ªπ</label>
                    <select class="chi-input" id="muc-dich-quy">
                        <option value="">Ch·ªçn m·ª•c ƒë√≠ch...</option>
                    </select>
                </div>

                <!-- M·ª•c ƒë√≠ch qu·ªπ cho tab Thu qu·ªπ (·∫©n m·∫∑c ƒë·ªãnh) -->
                <div class="chi-field" id="muc-dich-quy-thu-field" style="display: none;">
                    <label>Danh m·ª•c *</label>
                    <div class="chi-grid" id="muc-dich-quy-thu-grid"></div>
                </div>

                <!-- M·ª•c ƒë√≠ch qu·ªπ cho tab Chi qu·ªπ (·∫©n m·∫∑c ƒë·ªãnh) -->
                <div class="chi-field" id="muc-dich-quy-chi-field" style="display: none;">
                    <label>Danh m·ª•c *</label>
                    <div class="chi-grid" id="muc-dich-quy-chi-grid"></div>
                </div>

                <!-- N√∫t submit -->
                <button type="submit" class="chi-submit" id="submit-btn">Nh·∫≠p kho·∫£n Ti·ªÅn chi</button>
            </form>
        </div>

        <!-- L·ªãch Section -->
        <div id="lich-section" style="display: none;">
            <!-- Title -->
            <div class="chi-lich-title">L·ªãch th√°ng</div>
            <!-- Calendar Navigation -->
            <div class="chi-lich-nav">
                <button class="chi-lich-nav-btn" id="lich-prev-month">‚Üê</button>
                <button class="chi-lich-month-year" id="lich-month-year">12/2025</button>
                <button class="chi-lich-nav-btn" id="lich-next-month">‚Üí</button>
                <input type="month" id="lich-month-picker"
                    style="position:absolute;opacity:0;pointer-events:none;width:1px;height:1px;border:0;padding:0;margin:0;">
            </div>

            <!-- Calendar Grid -->
            <div class="chi-lich-calendar">
                <div class="chi-lich-weekdays">
                    <div class="chi-lich-weekday">CN</div>
                    <div class="chi-lich-weekday">T2</div>
                    <div class="chi-lich-weekday">T3</div>
                    <div class="chi-lich-weekday">T4</div>
                    <div class="chi-lich-weekday">T5</div>
                    <div class="chi-lich-weekday">T6</div>
                    <div class="chi-lich-weekday">T7</div>
                </div>
                <div class="chi-lich-days" id="lich-calendar-days"></div>
            </div>

            <!-- Financial Summary -->
            <div class="chi-lich-summary">
                <div class="chi-lich-summary-item">
                    <span class="chi-lich-summary-label">Thu nh·∫≠p</span>
                    <span class="chi-lich-summary-value thu" id="lich-summary-thu">0‚Ç´</span>
                </div>
                <div class="chi-lich-summary-item">
                    <span class="chi-lich-summary-label">Chi ti√™u</span>
                    <span class="chi-lich-summary-value chi" id="lich-summary-chi">0‚Ç´</span>
                </div>
                <div class="chi-lich-summary-item">
                    <span class="chi-lich-summary-label">T·ªïng</span>
                    <span class="chi-lich-summary-value tong" id="lich-summary-tong">0‚Ç´</span>
                </div>
            </div>

            <!-- Transactions List -->
            <div class="chi-lich-transactions" id="lich-transactions-list"></div>
        </div>

        <!-- B√°o c√°o Section -->
        <div id="bao-cao-section" style="display: none;">
            <div class="chi-field">
                <label>B√°o c√°o 5 nƒÉm (Thu / Chi / Qu·ªπ)</label>
                <div class="report-card">
                    <canvas id="report-chart" height="240"></canvas>
                </div>
            </div>

            <!-- B√°o c√°o th√°ng trong nƒÉm hi·ªán t·∫°i -->
            <div class="chi-field" style="margin-top: 2rem;">
                <label>B√°o c√°o th√°ng trong nƒÉm hi·ªán t·∫°i (Thu / Chi / Qu·ªπ)</label>
                <div class="report-card">
                    <canvas id="report-chart-monthly" height="240"></canvas>
                    <div id="report-months" class="report-years" style="margin-top:1rem;">
                        <div class="chi-cat placeholder">ƒêang t·∫£i...</div>
                    </div>
                </div>
            </div>

            <!-- B√°o c√°o ng√†y trong th√°ng hi·ªán t·∫°i -->
            <div class="chi-field" style="margin-top: 2rem;">
                <label id="daily-chart-label">B√°o c√°o ng√†y trong th√°ng hi·ªán t·∫°i (Thu / Chi / Qu·ªπ)</label>
                <div class="report-card">
                    <canvas id="report-chart-daily" height="240"></canvas>
                </div>
            </div>

            <!-- Ph√¢n b·ªï chi ti√™u theo danh m·ª•c -->
            <div class="chi-field" style="margin-top: 2rem;">
                <label id="category-chart-label">Ph√¢n b·ªï chi ti√™u theo danh m·ª•c th√°ng hi·ªán t·∫°i</label>
                <div class="report-card">
                    <div
                        style="display: flex; flex-wrap: wrap; align-items: center; justify-content: center; gap: 2rem;">
                        <div style="height: 300px; width: 300px; position: relative;">
                            <canvas id="report-chart-category"></canvas>
                        </div>
                        <div id="custom-legend"
                            style="background: rgba(255, 255, 255, 0.95); padding: 1.5rem; border-radius: 16px; color: #1f2937; min-width: 250px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
                            <!-- Legend items will be injected here -->
                        </div>
                    </div>
                </div>
            </div>

        </div>

        <!-- Menu Section -->
        <div id="menu-section" style="display: none;">
            <!-- Section T·∫°o danh m·ª•c m·ªõi -->
            <div style="margin-bottom: 2.5rem;">
                <h2
                    style="font-size: 1.25rem; font-weight: 700; color: #1f2937; margin-bottom: 1.25rem; padding-bottom: 0.75rem; border-bottom: 2px solid #e5e7eb;">
                    üìù T·∫°o danh m·ª•c m·ªõi</h2>
                <form id="category-form">
                    <div class="chi-field">
                        <label>Lo·∫°i danh m·ª•c *</label>
                        <select class="chi-input" id="category-type" required>
                            <option value="Chi">Chi ti√™u</option>
                            <option value="Thu">Thu nh·∫≠p</option>
                            <option value="Quy">Qu·ªπ (Thu & Chi qu·ªπ)</option>
                        </select>
                    </div>
                    <div class="chi-field">
                        <label>Icon</label>
                        <input type="text" class="chi-input" id="icon-picker-input" list="icon-list"
                            placeholder="Ch·ªçn ho·∫∑c nh·∫≠p icon (emoji)">
                        <datalist id="icon-list"></datalist>
                    </div>
                    <div class="chi-field">
                        <label>T√™n danh m·ª•c *</label>
                        <input type="text" class="chi-input" id="category-name" placeholder="Nh·∫≠p t√™n danh m·ª•c"
                            required>
                    </div>
                    <button type="submit" class="chi-submit">T·∫°o danh m·ª•c</button>
                </form>
            </div>

            <!-- Danh s√°ch danh m·ª•c -->
            <div style="margin-top: 2.5rem;">
                <h2
                    style="font-size: 1.25rem; font-weight: 700; color: #1f2937; margin-bottom: 1.25rem; padding-bottom: 0.75rem; border-bottom: 2px solid #e5e7eb;">
                    ‚öôÔ∏è Qu·∫£n l√Ω danh m·ª•c</h2>
                <div class="chi-field">
                    <label>Lo·∫°i danh m·ª•c</label>
                    <select class="chi-input" id="category-list-type">
                        <option value="Chi">Chi ti√™u</option>
                        <option value="Thu">Thu nh·∫≠p</option>
                        <option value="Quy">Qu·ªπ</option>
                    </select>
                </div>
                <div id="category-list-container" style="margin-top: 1rem;">
                    <div class="chi-cat placeholder">Ch·ªçn lo·∫°i danh m·ª•c ƒë·ªÉ xem danh s√°ch</div>
                </div>
            </div>
        </div>

        <!-- Modal s·ª≠a danh m·ª•c -->
        <div class="chi-modal-overlay" id="edit-category-modal" style="display: none;">
            <div class="chi-modal">
                <div class="chi-modal-header">
                    <h3>‚úèÔ∏è S·ª≠a danh m·ª•c</h3>
                    <button type="button" class="chi-modal-close" id="edit-category-close">&times;</button>
                </div>
                <form id="edit-category-form">
                    <input type="hidden" id="edit-category-row">
                    <input type="hidden" id="edit-category-type">
                    <input type="hidden" id="edit-category-column">
                    <input type="hidden" id="edit-category-old-value">
                    <div class="chi-field">
                        <label>Icon</label>
                        <input type="text" class="chi-input" id="edit-icon-picker-input" list="icon-list"
                            placeholder="Ch·ªçn ho·∫∑c nh·∫≠p icon (emoji)">
                    </div>
                    <div class="chi-field">
                        <label>T√™n danh m·ª•c *</label>
                        <input type="text" class="chi-input" id="edit-category-name" placeholder="Nh·∫≠p t√™n danh m·ª•c"
                            required>
                    </div>
                    <div class="chi-modal-actions">
                        <button type="button" class="chi-btn-cancel" id="edit-category-cancel">H·ªßy</button>
                        <button type="submit" class="chi-btn-submit">L∆∞u</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Calendar Modal -->
    <div class="calendar-modal" id="calendar-modal" style="display: none;">
        <div class="calendar-overlay" id="calendar-overlay"></div>
        <div class="calendar-container">
            <div class="calendar-header">
                <button type="button" class="calendar-nav-btn" id="calendar-prev-month">‚Üê</button>
                <div class="calendar-month-year" id="calendar-month-year"></div>
                <button type="button" class="calendar-nav-btn" id="calendar-next-month">‚Üí</button>
            </div>
            <div class="calendar-weekdays">
                <div class="calendar-weekday">CN</div>
                <div class="calendar-weekday">T2</div>
                <div class="calendar-weekday">T3</div>
                <div class="calendar-weekday">T4</div>
                <div class="calendar-weekday">T5</div>
                <div class="calendar-weekday">T6</div>
                <div class="calendar-weekday">T7</div>
            </div>
            <div class="calendar-days" id="calendar-days"></div>
        </div>
    </div>

    <!-- Calendar Popup for Month/Year Selection -->
    <div class="chi-lich-popup-overlay" id="lich-popup-overlay" style="display: none;">
        <div class="chi-lich-popup">
            <div class="chi-lich-popup-nav">
                <button class="chi-lich-nav-btn" id="lich-popup-prev-month">‚Üê</button>
                <div class="chi-lich-month-year" id="lich-popup-month-year">Th√°ng 12 2025</div>
                <button class="chi-lich-nav-btn" id="lich-popup-next-month">‚Üí</button>
            </div>
            <div class="chi-lich-popup-calendar">
                <div class="chi-lich-popup-weekdays">
                    <div class="chi-lich-popup-weekday">CN</div>
                    <div class="chi-lich-popup-weekday">T2</div>
                    <div class="chi-lich-popup-weekday">T3</div>
                    <div class="chi-lich-popup-weekday">T4</div>
                    <div class="chi-lich-popup-weekday">T5</div>
                    <div class="chi-lich-popup-weekday">T6</div>
                    <div class="chi-lich-popup-weekday">T7</div>
                </div>
                <div class="chi-lich-popup-days" id="lich-popup-days"></div>
            </div>
        </div>
    </div>


    <!-- Bottom Navigation -->
    <div class="chi-bottom">
        <button class="chi-bottom-item active" id="nav-nhap-vao">
            <span class="icon">‚úèÔ∏è</span>
            <span>Nh·∫≠p v√†o</span>
        </button>
        <button class="chi-bottom-item" id="nav-lich">
            <span class="icon">üìÖ</span>
            <span>L·ªãch</span>
        </button>
        <button class="chi-bottom-item" id="nav-bao-cao">
            <span class="icon">üìä</span>
            <span>B√°o c√°o</span>
        </button>
        <button class="chi-bottom-item">
            <span class="icon">‚ãØ</span>
            <span>Menu</span>
        </button>
    </div>

    <script src="{{ url_for('static', filename='chi_tieu.js') }}" defer></script>
</body>

</html>